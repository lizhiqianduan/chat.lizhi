function getById(a){return document.getElementById(a)}function getNameFormCookie(){var a=document.cookie.split(";");if(a.length)for(var b=0;b<a.length;b++){var c=a[b].split("=");if("lz-username"==c[0].trim()&&c[1])return c[1]}return""}function addTimeTip(a){var b='<div class="chat_time"><span>'+a+"</span></div>";document.getElementById("panelBody-5").innerHTML+=b,chatBoxScrollBottom()}function addOtherClentMessage(a,b){a=lzFaceModule.strToFace(a),b=lzFaceModule.letStrSecurity(b);var c='<div class="chat_content_group buddy " ><img class="chat_content_avatar" src="./QQ_files/getface(1)" width="40px" height="40px"><p class="chat_nick">'+b+'</p><p class="chat_content ">'+a+" </p></div>";document.getElementById("panelBody-5").innerHTML+=c,chatBoxScrollBottom()}function addMyMessage(a,b){a=lzFaceModule.strToFace(a),a=lzFaceModule.letStrSecurity(a),b=lzFaceModule.letStrSecurity(b);var c='<div class="chat_content_group self  " ><img class="chat_content_avatar" src="./QQ_files/getface"><p class="chat_nick">'+b+'</p><p class="chat_content ">'+a+"</p></div>";document.getElementById("panelBody-5").innerHTML+=c,chatBoxScrollBottom()}function chatBoxScrollBottom(){getById("panelBodyWrapper-5").scrollTop=9999999}function titleBlink(){if(!titleIsBlink){titleIsBlink=!0;var a=document.title;document.title="你有新消息了!!!";var b=0,c=setInterval(function(){b%2==0?document.title=a:document.title="....新消息....",b++,7==b&&(clearInterval(c),titleIsBlink=!1)},500)}}function sendMessageToServer(a){socket.send(a)}function sendBtnClick(){var a=document.getElementById("chat_textarea").value;if(a&&username){var b=(new Date).getTime();if(800>b-lastSendTime)return void addTimeTip("发言最小间隔为1秒，否则会按刷屏处理");lastSendTime=(new Date).getTime(),addMyMessage(a,username),sendMessageToServer({message:a,username:username}),document.getElementById("chat_textarea").value="",document.documentElement.clientWidth>640&&document.getElementById("chat_textarea").focus()}}function lzSureClick(){if(getById("lz-username").value){if(username=getById("lz-username").value,username.length>50)return void alert("你的名字太长了");setCookie("lz-username",username,24),getById("lz-mask").style.display="none",bindSocketEvent()}}function setCookie(a,b,c){c=c?c:1;var d=new Date;d.setTime(d.getTime()+60*c*60*1e3),document.cookie=a+"="+b+";expires="+d.toGMTString()}function loginOut(){setCookie("lz-username","",-3),alert("怎么就退出了呢!改个名字再来啊~~"),window.location.reload()}function bindSocketEvent(){socket=io.connect(window.location.hostname),socket.on("connect",function(){console.log("connect success"),socket.emit("checkUsername",{username:username})}),socket.on("usernameCheckSuccess",function(a){getById("lz-logined-name").innerText=username,addTimeTip((new Date).toLocaleTimeString()),addOtherClentMessage(username+"，你好！你已经进入聊天室了，快和大家打个招呼吧！","小黑的智能机器人"),addTimeTip("现版本聊天室没有数据库作存储，所以...千万别刷新!"),addOtherClentMessage("如果大家在交流过程中遇到什么问题，可以到我建的一个web交流群里面去找我，群号：439366057","小黑的智能机器人"),addOtherClentMessage("也可以到我的个人网站上去留言：<a href='http://www.lizhiqianduan.com' target='_blank'>www.lizhiqianduan.com 励志前端</a>，祝大家交流愉快！","小黑的智能机器人")}),socket.on("emitMessage",function(a){allMesNum++,allMesNum>100&&(getById("panelBody-5").innerHTML="",allMesNum=0,addTimeTip("消息接收已经达到100条了，系统已自动清理")),a.sendSuccess,a.otherClientData&&(titleBlink(),addOtherClentMessage(a.message,a.username))}),socket.on("refreshUserList",function(a){var b=a.length;getById("lz-user-number").innerText=b;var c=getById("groupBodyUl-0");c.innerHTML="";for(var d=0;d<a.length;d++)if(a[d].username){var e='<li id="'+a[d].connId+'" class="list_item" _uin="418131904" _type="friend" cmd="clickMemberItem"><a href="javascript:void(0);" class="avatar" cmd="clickMemberAvatar" _uin="418131904" _type="friend"><img src="./QQ_files/getface(1)" class="lazyLoadImg loaded"></a><p class="member_nick" id="userNick-418131904"> '+a[d].username+' </p><p class="member_msg text_ellipsis"><span class="member_state">[在线]</span><span class="member_signature" title="IP:'+a[d].userIp+'">鼠标悬浮可查看对方ip</span></p></li>';c.innerHTML+=e}}),socket.on("usernameCheckFail",function(a){setCookie("lz-username",-2);var b=getById("lz-mask");b.style.display="block",getById("namewrap").innerHTML+='<div style="color:red;">'+a.errMsg+"<br>重新取个牛逼的名字吧</div>"}),socket.on("disconnect",function(){console.log("The client has disconnected!")})}function init(){var a=navigator.userAgent.toLowerCase().match(/msie.*?;/),b=a?a[0].match(/\d/):null;return b&&9>b?(alert("本聊天室不支持ie8及其以下的古老浏览器，渣渣浏览器，赶紧换了吧！"),void(document.body.innerHTML="本聊天室不支持ie8及其以下的古老浏览器，渣渣浏览器，赶紧换了吧!")):(""==getNameFormCookie()?getById("lz-mask").style.display="block":(username=getNameFormCookie(),bindSocketEvent()),void lzFaceModule.init())}var socket=null,username="",titleIsBlink=!1,lastSendTime=0,allMesNum=0,lzFaceModule={faceIsOpen:!1,faceZh:[],init:function(){var a=getById("face_images"),b=a.getElementsByTagName("i");this.faceImgToStr(b),this.bintEvent()},faceImgToStr:function(a){for(var b=0;b<a.length;b++)"delKey"!=a[b].title&&this.faceZh.push("["+a[b].title+"]")},strToFace:function(a){var b=a.replace(/\[.{1,3}\]/g,function(a,b,c){var d=lzFaceModule.faceZh.indexOf(a);return d>-1?'<img src="http://pub.idqqimg.com/lib/qqface/'+d+'.gif" alt="">':""||a});return b},faceBtnClick:function(){this.faceIsOpen?this.hideFace():this.showFace()},showFace:function(){this.faceIsOpen=!0;var a=getById("face_images");a.style.display="block",a.getElementsByTagName("ul")[0].style.display="block",a.getElementsByTagName("ul")[0].style.width="4200px",getById("panelBodyWrapper-5").style.height=getById("panel-5").offsetHeight-getById("panelHeader-5").offsetHeight-getById("panelFooter-5").offsetHeight+"px",chatBoxScrollBottom()},hideFace:function(){this.faceIsOpen=!1;var a=getById("face_images");a.style.display="none",a.getElementsByTagName("ul")[0].style.display="none",getById("panelBodyWrapper-5").style.height=getById("panel-5").offsetHeight-getById("panelHeader-5").offsetHeight-getById("panelFooter-5").offsetHeight+"px"},bintEvent:function(){for(var a=getById("face_images"),b=a.getElementsByTagName("ul")[1].getElementsByTagName("li"),c=a.getElementsByTagName("i"),d=0;d<b.length;d++)b[d].onclick=function(c){return function(){for(var d=0;d<b.length;d++)b[d].className="";b[c].className="selected",a.getElementsByTagName("ul")[0].style.left=-a.getElementsByTagName("ul")[0].getElementsByTagName("li")[0].offsetWidth*c+"px"}}(d);for(var e=0;e<c.length;e++)"delKey"!=c[e].title&&(c[e].onclick=function(a){return function(){getById("chat_textarea").value+="["+this.title+"]"}}(e));window.onresize=function(){getById("panelBodyWrapper-5").style.height=getById("panel-5").offsetHeight-getById("panelHeader-5").offsetHeight-getById("panelFooter-5").offsetHeight+"px"}},inputOnFocus:function(){document.documentElement.clientWidth<640&&this.hideFace()},letStrSecurity:function(a){var b=new RegExp(/<img +src="[^"]+"{1}? +alt="" *\/{0,1}>/);if(b.test(a))return a;var c=a.replace(/(<)|(>)|&|-|"/g,function(a,b,c){return/</.test(a)?"&lt;":/>/.test(a)?"&gt;":/&/.test(a)?"&amp;":/"/.test(a)?"&quot;":void 0});return c}};init();