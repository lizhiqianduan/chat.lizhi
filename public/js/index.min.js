function getById(a){return document.getElementById(a)}function getNameFormCookie(){var a=document.cookie.split(";");if(a.length)for(var b=0;b<a.length;b++){var c=a[b].split("=");if("lz-username"==c[0].trim()&&c[1])return c[1]}return""}function addTimeTip(a){var b='<div class="chat_time"><span>'+a+"</span></div>";document.getElementById("panelBody-5").innerHTML+=b,chatBoxScrollBottom()}function addOtherClentMessage(a,b){var c='<div class="chat_content_group buddy  " _sender_uin="418131904"><img class="chat_content_avatar" src="./QQ_files/getface(1)" width="40px" height="40px"><p class="chat_nick">'+b+'</p><p class="chat_content ">'+a+" </p></div>";document.getElementById("panelBody-5").innerHTML+=c,chatBoxScrollBottom()}function addMyMessage(a,b){var c='<div class="chat_content_group self  " ><img class="chat_content_avatar" src="./QQ_files/getface"><p class="chat_nick">'+b+'</p><p class="chat_content ">'+a+"</p></div>";document.getElementById("panelBody-5").innerHTML+=c,chatBoxScrollBottom()}function chatBoxScrollBottom(){getById("panelBodyWrapper-5").scrollTop=9999999}function titleBlink(){if(!titleIsBlink){titleIsBlink=!0;var a=document.title;document.title="你有新消息了!!!";var b=0,c=setInterval(function(){b%2==0?document.title=a:document.title="....新消息....",b++,7==b&&(clearInterval(c),titleIsBlink=!1)},500)}}function sendMessageToServer(a){socket.send(a)}function sendBtnClick(){document.getElementById("chat_textarea").value&&username&&(sendMessageToServer({message:document.getElementById("chat_textarea").value,username:username}),document.getElementById("chat_textarea").value="")}function lzSureClick(){getById("lz-username").value&&(username=getById("lz-username").value,setCookie("lz-username",username,24),getById("lz-mask").style.display="none",bindSocketEvent())}function setCookie(a,b,c){c=c?c:1;var d=new Date;d.setTime(d.getTime()+60*c*60*1e3),document.cookie=a+"="+b+";expires="+d.toGMTString()}function loginOut(){setCookie("lz-username","",-3),window.location.reload()}function bindSocketEvent(){var a=io.connect(window.location.hostname);a.on("connect",function(){console.log("connect success"),a.emit("checkUsername",{username:username})}),a.on("usernameCheckSuccess",function(a){getById("lz-logined-name").innerText=username,addTimeTip((new Date).toLocaleTimeString()),addOtherClentMessage(username+"，你好！你已经进入聊天室了，快和大家打个招呼吧！","小黑的智能机器人"),addTimeTip("现版本聊天室没有数据库作存储，所以...千万别刷新!")}),a.on("emitMessage",function(a){a.sendSuccess&&addMyMessage(a.message,username),a.otherClientData&&(titleBlink(),addOtherClentMessage(a.message,a.username))}),a.on("refreshUserList",function(a){var b=a.length;getById("lz-user-number").innerText=b;var c=getById("groupBodyUl-0");c.innerHTML="";for(var d=0;d<a.length;d++)if(a[d].username){var e='<li id="'+a[d].connId+'" class="list_item" _uin="418131904" _type="friend" cmd="clickMemberItem"><a href="javascript:void(0);" class="avatar" cmd="clickMemberAvatar" _uin="418131904" _type="friend"><img src="./QQ_files/getface(1)" class="lazyLoadImg loaded"></a><p class="member_nick" id="userNick-418131904"> '+a[d].username+' </p><p class="member_msg text_ellipsis"><span class="member_state">[在线]</span><span class="member_signature" title="IP:'+a[d].userIp+'">鼠标悬浮可查看对方ip</span></p></li>';c.innerHTML+=e}}),a.on("usernameCheckFail",function(a){var b=getById("lz-mask");b.style.display="block",getById("namewrap").innerHTML+='<div style="color:red;">该名字已经在别处登陆了~~<br>重新取个牛逼的名字吧</div>'}),a.on("disconnect",function(){console.log("The client has disconnected!")})}function init(){""==getNameFormCookie()?getById("lz-mask").style.display="block":confirm("检测到你之前登陆过，是否使用之前的名字开始交流")?(username=getNameFormCookie(),bindSocketEvent()):getById("lz-mask").style.display="block"}var socket=null,username="",titleIsBlink=!1;init();